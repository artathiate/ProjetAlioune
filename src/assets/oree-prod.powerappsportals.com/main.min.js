$(".text-input-wrapper input, .text-input-wrapper textarea").each(function(e){""!=$(this).val()?$(this).addClass("not-empty").parent().addClass("not-empty"):$(this).removeClass("not-empty").parent().removeClass("not-empty")}),$(document).off("change focusout keydown keypress input",".text-input-wrapper input, .text-input-wrapper textarea").on("change focusout keydown keypress input",".text-input-wrapper input, .text-input-wrapper textarea",function(e){""!=$(this).val()?$(this).addClass("not-empty").parent().addClass("not-empty"):$(this).removeClass("not-empty").parent().removeClass("not-empty")}),$(document).off("cut copy paste",".no-paste").on("cut copy paste",".no-paste",function(e){e.preventDefault()}),$(document).off("change",".control-duplicate").on("change",".control-duplicate",function(e){var t,a=$(this).attr("name"),n=$(this).val();$(this).is('input[type="radio"]')&&(t=$('[name="'+a+'"]').not('input[type="radio"]'),$(t).val(n).addClass("not-empty").niceSelect("update"),$(t).next().addClass("not-empty")),$(this).is('input[type="checkbox"]')&&(t=$('[name="'+a+'"][value="'+n+'"]').not($(this)).not($(this).parents(".custom-control, .button-control__wrapper").find("input")),$(this).is(":checked")?$(t).prop("checked",!0):$(t).prop("checked",!1)),$(this).is("select")&&(t=$('[name="'+a+'"]').not("select"),$(t).each(function(){$(this).val()==n&&$(this).prop("checked",!0).trigger("change")}))}),$(document).off("focusin",".text-input-wrapper input, .text-input-wrapper textarea").on("focusin",".text-input-wrapper input, .text-input-wrapper textarea",function(e){$(this).parent().addClass("focused")}),$(document).off("focusout",".text-input-wrapper input, .text-input-wrapper textarea").on("focusout",".text-input-wrapper input, .text-input-wrapper textarea",function(e){$(this).parent().removeClass("focused")}),$(document).off("keypress keyup blur",".only-digits").on("keypress keyup blur",".only-digits",function(e){$(this).val($(this).val().replace(/[^0-9]/g,"")),(e.which<48||57<e.which)&&e.preventDefault()}),$(document).off("keypress keyup blur",".only-floats").on("keypress keyup blur",".only-floats",function(e){$(this).val($(this).val().replace(/[^0-9\,.]/g,"")),-1==$(this).val().indexOf(".")&&-1==$(this).val().indexOf(",")||!(e.which<48||57<e.which)||e.preventDefault()}),$("select").each(function(e){$(this).children("option:selected").is(":disabled")?$(this).removeClass("not-empty"):$(this).addClass("not-empty")}),768<=$(window).width()&&($(".nos-solutions__sidebar-inner").sticky({topSpacing:55}),$(".etude-logement__sidebar-content").sticky({topSpacing:55})),window.showLoading=function(){$("#loading_block").fadeIn(200)},window.hideLoading=function(){$("#loading_block").fadeOut(200)}
window.initSelects = function () {
		$('select').each(function () {
			if (!$(this).hasClass('nice-select-initialized')) {
				$(this).niceSelect();
			}
		});
}
window.numberPretty=function(e){return e.toString().replace(/\B(?=(\d{3})+(?!\d))/g," ")},window.openHeaderMenu=function(){$("#header_menu").addClass("active"),$("#header_menu_overlay").fadeIn(200)},window.closeHeaderMenu=function(){$("#header_menu").removeClass("active"),$("#header_menu_overlay").fadeOut(200)},$(document).off("click",'[data-toggle="demo_loader"]').on("click",'[data-toggle="demo_loader"]',function(e){showLoading(),setTimeout(hideLoading,2e3)}),$(document).off("change focusout",".form-validate select").on("change focusout",".form-validate select",function(e){$(this).children("option:selected").is(":disabled")?$(this).removeClass("not-empty"):$(this).addClass("not-empty"),$(this).valid()}),767<$(window).width()&&($("select").niceSelect(),$(document).on("click.nice_select",".nice-select .option:not(.disabled)",function(e){$(this).parents(".nice-select").addClass("not-empty")})),$('[data-toggle="tooltip"]').tooltip(),$(document).off("click","[data-quant-control]").on("click","[data-quant-control]",function(e){e.preventDefault();var t=$(this).parents(".quant-input-group").find("input"),a=$(t).val();a=parseFloat($(t).val().replace(",","."));var n=!0;-1!=$(t).val().indexOf(".")&&(n=!1);var i=$(this).attr("data-quant-control"),o=parseFloat($(t).attr("min")),s=parseFloat($(t).attr("max")),r=parseFloat($(t).attr("data-step"))||1,l=a+r,c=a-r;n&&(l=l.toString().replace(".",","),c=c.toString().replace(".",",")),"plus"==i?(a<s?$(t).val(l).trigger("change"):$(this).parent().find(".plus").addClass("disabled"),$(this).parent().find(".minus.disabled").removeClass("disabled")):(o<a&&$(t).val(c).trigger("change"),2==a&&$(this).parent().find(".minus").addClass("disabled"))}),$(document).off("click",".collapser").on("click",".collapser",function(e){$(this).toggleClass("active").next().collapse("toggle")}),$(document).off("click",".upl-docs-module__item-toggle").on("click",".upl-docs-module__item-toggle",function(e){$(this).toggleClass("active").next().collapse("toggle").parent().toggleClass("active")}),$(document).off("change",'.compass-module input[type="radio"]').on("change",'.compass-module input[type="radio"]',function(e){if($(this).is(":checked")){var t=$(this).attr("data-class");$(this).parents(".compass-module").find(".compass-module__circle").attr("class","compass-module__circle "+t)}}),$(document).off("change",'input[type="radio"], input[type="checkbox"]').on("change",'input[type="radio"], input[type="checkbox"]',function(e){var t=$(this).attr("name");$('input[name="'+t+'"]').not($(this)).parent().removeClass("checked"),$(this).is(":checked")?$(this).parent().addClass("checked"):$(this).parent().removeClass("checked")}),$(document).ready(function(){$(".tabs-wrapper").each(function(){var e=$(this).find(".active"),t=$(e).offset().left-30;$(this).scrollLeft(t)}),$('input[type="radio"], input[type="checkbox"]').each(function(e){$(this).is(":checked")&&$(this).parent().addClass("checked")})}),$("#nos_solutions_topbar_slider").on("init.slick",function(){var e=$(this),t=$(this).find("input:checked"),a=0;a=0<$(t).length?($(t).trigger("click"),$(t).index()):$(e).find("a.active").parents(".slick-slide").data("slick-index"),1200<$(window).width()&&$(e).on("mousedown",function(e){$(this).one("mouseup",function(e){$(this).removeClass("changing"),$(this).off("mousemove")}).on("mousemove",function(e){$(this).addClass("changing")})}),setTimeout(function(){$("#nos_solutions_topbar_slider").slick("slickGoTo",a)},0)}),$("#nos_solutions_topbar_slider").slick({slidesToShow:5,slidesToScroll:1,infinite:!1,arrows:!0,swipeToSlide:!0,focusOnSelect:!0,touchThreshold:10,edgeFriction:0,dots:!1,prevArrow:'<a href="javascript:;" class="nos-solutions__slider-arrow prev"><i class="material-icons">chevron_left</i></a>',nextArrow:'<a href="javascript:;" class="nos-solutions__slider-arrow next"><i class="material-icons">chevron_right</i></a>',responsive:[{breakpoint:992,settings:{slidesToShow:4}},{breakpoint:768,settings:{slidesToShow:1,centerMode:!0,centerPadding:"0px",variableWidth:!0,arrows:!1}}]});var headerActiveLink=$("#header_nav").find("li.active").index();$("#header_nav").slick({variableWidth:!0,centerMode:!0,initialSlide:headerActiveLink,centerPadding:"0px",infinite:!1,arrows:!0,mobileFirst:!0,swipeToSlide:!0,dots:!1,prevArrow:'<a href="javascript:;" class="page-header__nav-arrow prev"><i class="material-icons">chevron_left</i></a>',nextArrow:'<a href="javascript:;" class="page-header__nav-arrow next"><i class="material-icons">chevron_right</i></a>',responsive:[{breakpoint:767,settings:"unslick"}]}),$(window).on("resize orientationchange load",function(){$("#nos_solutions_topbar_slider").slick("resize"),$("#header_nav").slick("resize"),$("#nos_solutions_topbar_slider").slick("setPosition"),$("#header_nav").slick("setPosition"),90==window.orientation||-90==window.orientation?$("body").addClass("landscape-orientation"):$("body").removeClass("landscape-orientation")}),$(".tel-mask").inputmask({mask:["+99 9 99 99 99 99","+99 (999) 999 9999"],keepStatic:!0,defaultValue:"+33",clearIncomplete:!0,autoUnmask:!1,removeMaskOnSubmit:!1,showMaskOnHover:!1,onBeforePaste:function(e,t){return!1}}),$(".tel-mask").on("focusin",function(e){0<!$(this).val().length&&$(this).val("+33")}),$(".code-postal").inputmask({mask:"99999",clearIncomplete:!0,autoUnmask:!1,removeMaskOnSubmit:!1,showMaskOnHover:!1}),$(".date-mask").inputmask({alias:"datetime",min:"01/01/1920",max:"12/12/2010",inputFormat:"dd/mm/yyyy",placeholder:"__/__/____",clearIncomplete:!0,autoUnmask:!1,removeMaskOnSubmit:!1,showMaskOnHover:!1}),$.extend($.validator.messages,{required:"Veuillez renseigner ce champ",email:"Merci de saisir une adresse email correcte",url:"Merci de saisir une URL correcte.",date:"Merci de saisir une date correcte.",number:"Veuillez saisir un format numérique",digits:"Merci de saisir uniquement des chiffres.",creditcard:"Merci d'entrer une carte de crédit valide.",equalTo:"Merci de saisir des mots de passe identiques",accept:"Merci de saisir une valeur avec une extension correcte.",maxlength:jQuery.validator.format("Merci de ne pas rentrer plus de {0} caractères."),minlength:jQuery.validator.format("Merci de saisir au moins {0} caractères."),rangelength:jQuery.validator.format("Merci de saisir une valeur comprise entre {0} et {1} caractères."),range:jQuery.validator.format("Merci de saisir une valeur entre {0} et {1}."),max:jQuery.validator.format("Merci de saisir une valeur inférieure ou égale à {0}."),min:jQuery.validator.format("Merci de saisir une valeur supérieure ou égale à {0}.")}),$.validator.methods.email=function(e,t){return this.optional(t)||/[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?/.test(e)},$.validator.addMethod("lettersonly",function(e,t){return this.optional(t)||/^[a-z]+$/i.test(e)},"Veuillez saisir uniquement du texte."),$.validator.methods.number=function(e,t){return this.optional(t)||/^-?(?:\d+|\d{1,3}(?:[\s\.,]\d{3})+)(?:[\.,]\d+)?$/.test(e)},$.validator.methods.range=function(e,t,a){var n=e.replace(",",".");return this.optional(t)||n>=a[0]&&n<=a[1]},$.validator.methods.min=function(e,t,a){return e=e.replace(",","."),this.optional(t)||a<=e},$.validator.methods.max=function(e,t,a){return e=e.replace(",","."),this.optional(t)||e<=a},$(document).ready(function(){$(".form-validate").each(function(){$(this).validate({validateDelegate:function(){},onsubmit:!0,errorElement:"div",errorPlacement:function(e,t){switch(e.addClass("invalid-feedback"),t.prop("type")){case"select-one":e.appendTo(t.parent());break;case"checkbox":e.insertAfter(t.parent("label"));break;case"radio":t.parent().hasClass("button-control")?e.appendTo(t.parents(".row, .form-row")[0]):e.insertAfter(t.parent("label"));break;case"file":e.appendTo(t.parents(".form-row").parent());break;default:$(this).parents(".input-group")?e.insertAfter(t.parent()):e.insertAfter(t)}},highlight:function(e,t,a){$(e).addClass("is-invalid").parent().addClass("is-invalid")},unhighlight:function(e,t,a){$(e).removeClass("is-invalid").parent().removeClass("is-invalid")},focusInvalid:!1,invalidHandler:function(e,t){if(t.numberOfInvalids()){$(t.errorList).each(function(){0<$(this.element).parents(".collapse:not(.show)").length&&$(this.element).parents(".collapse").collapse("toggle").prev().addClass("active").parent().addClass("active")});var a=$(t.errorList[0].element);if("select-one"!==$(a).prop("type")&&"radio"!==$(a).prop("type")&&"checkbox"!==$(a).prop("type")||(a=$(a).parent()),0<$(a).parents(".modal").length){var n=$(this).parents(".modal"),i=$(n).scrollTop()+$(a).offset().top-120;$(n).animate({scrollTop:i},400)}else{i=$(a).offset().top-120;$("html, body").animate({scrollTop:i},400)}}},ignore:".tab-pane:hidden *, .body:not(.current) *, .control-mobile-hidden:hidden *, .control-only-mobile:hidden *, :disabled, .no-validate"}),setTimeout(function(){$(this).find(".num-input").each(function(){$(this).rules("add",{required:!0,number:!0})}),$(this).find('[type="email"]').each(function(){$(this).rules("add",{required:!0,email:!0})})},0)})}),$(document).off("change",'[data-toggle="check-tab"]').on("change",'[data-toggle="check-tab"]',function(){var a=$(this).attr("data-target"),n=$(this);if(0<$(a).length)if($(this).is(":checked")){$(a).addClass("active").siblings().removeClass("active");var e=$(a).siblings();if($(a).find("input, select:not(.control-duplicate)").each(function(){var e=$(this),t=$(e).attr("name"),a=$('[data-control-name="'+t+'"]');$(this).is('[type="checkbox"]')||$(this).is('[type="radio"]')?$(this).is(":checked")&&0<!$(e).parents(".tab-pane:not(.active)").length&&0<$(a).length&&$(a).addClass("active"):""!=$(this).val()&&0<!$(e).parents(".tab-pane:not(.active)").length&&0<$(a).length&&$(a).addClass("active")}),$(e).find("input, select:not(.control-duplicate)").each(function(){$(this);var e=$(this).attr("name"),t=$('[data-control-name="'+e+'"]');0<$(t).length&&$(t).removeClass("active")}),!$(this).is("[data-tab-no-scroll]"))if(0<$(n).parents(".modal").length)setTimeout(function(){var e=$(n).parents(".modal"),t=$(e).scrollTop()+$(a).offset().top-120;$(e).animate({scrollTop:t},400)},0);else{var t=$(a).offset().top-120;$("html, body").animate({scrollTop:t},400)}}else $(a).removeClass("active"),$(a).find("input, select:not(.control-duplicate)").each(function(){$(this);var e=$(this).attr("name"),t=$('[data-control-name="'+e+'"]');0<$(t).length&&$(t).removeClass("active")})}),$(document).off("change",'[data-toggle="check-tabs-control"]').on("change",'[data-toggle="check-tabs-control"]',function(){var e=$(this).data("hide-target"),a=$(this).data("show-target"),n=$(this);0<$(e).length&&$(this).is(":checked")&&($(e).removeClass("active"),$(e).children(".tab-pane.active").removeClass("active"),$(e).each(function(){$(this).find("input, select:not(.control-duplicate)").each(function(){$(this);var e=$(this).attr("name"),t=$('[data-control-name="'+e+'"]');0<$(t).length&&$(t).removeClass("active")})})),setTimeout(function(){if(0<$(a).length&&$(n).is(":checked")){$(a).addClass("active").siblings().removeClass("active");var e=$(a).siblings();$(a).find("input, select:not(.control-duplicate)").each(function(){var e=$(this),t=$(e).attr("name"),a=$('[data-control-name="'+t+'"]');$(this).is('[type="checkbox"]')||$(this).is('[type="radio"]')?$(this).is(":checked")&&0<!$(e).parents(".tab-pane:not(.active)").length&&0<$(a).length&&$(a).addClass("active"):""!=$(this).val()&&0<!$(e).parents(".tab-pane:not(.active)").length&&0<$(a).length&&$(a).addClass("active")}),$(e).find("input, select:not(.control-duplicate)").each(function(){$(this);var e=$(this).attr("name"),t=$('[data-control-name="'+e+'"]');0<$(t).length&&$(t).removeClass("active")}),setTimeout(function(){if(!$(n).is("[data-tab-no-scroll]"))if(0<$(n).parents(".modal").length){var e=$(n).parents(".modal"),t=$(e).scrollTop()+$(a).offset().top-120;$(e).animate({scrollTop:t},400)}else{t=$(a).offset().top-120;$("html, body").animate({scrollTop:t},400)}},0)}},0)}),$(document).off("click change",'[data-toggle="check-hide-tabs"]').on("click change",'[data-toggle="check-hide-tabs"]',function(){var e=$(this).attr("data-target");0<$(e).length&&$(this).is(":checked")&&($(e).find(".tab-pane").removeClass("active"),$(e).find("input, select:not(.control-duplicate)").each(function(){$(this);var e=$(this).attr("name"),t=$('[data-control-name="'+e+'"]');0<$(t).length&&$(t).removeClass("active")}))}),$(document).off("click change",'[data-toggle="hide-tabs"]').on("click change",'[data-toggle="hide-tabs"]',function(){var e=$(this).attr("data-target");0<$(e).length&&($(e).find(".tab-pane").removeClass("active"),$(e).find("input, select:not(.control-duplicate)").each(function(){$(this);var e=$(this).attr("name"),t=$('[data-control-name="'+e+'"]');0<$(t).length&&$(t).removeClass("active")}))}),$(document).off("click","[data-toggle='show_hide_password']").on("click","[data-toggle='show_hide_password']",function(e){e.preventDefault();var t=$(this).parent().find("input");"password"==$(t).attr("type")?$(t).attr("type","text"):$(t).attr("type","password"),$(this).toggleClass("active")}),$(document).off("click",'[data-toggle="produits_info_more"]').on("click",'[data-toggle="produits_info_more"]',function(e){e.preventDefault(),$(this).toggleClass("active").parents(".cart-block__item-main-content").find("ul").toggleClass("active")}),$(document).off("click",'[data-toggle="close-menu"]').on("click",'[data-toggle="close-menu"]',function(e){e.preventDefault(),closeHeaderMenu()}),$(document).off("click",'[data-toggle="open-menu"]').on("click",'[data-toggle="open-menu"]',function(e){e.preventDefault(),openHeaderMenu()}),$(document).on("click",'[data-target="#consumption_chauffage_modal"]',function(){$("body").addClass("purple-backdrop")}),$(document).on("click",'[data-target="#consumption_ecs_modal"]',function(){$("body").addClass("blue-backdrop")}),$(document).on("click",'[data-target="#consumption_taches_modal"]',function(){$("body").addClass("red-backdrop")}),$(document).on("click",'[data-target="#consumption_eclairage_modal"]',function(){$("body").addClass("green-backdrop")}),$(".modal").on("hidden.bs.modal",function(e){$("body").removeClass("purple-backdrop green-backdrop red-backdrop blue-backdrop")}),File.prototype.convertToBase64=function(t){var e=new FileReader;e.onloadend=function(e){t(e.target.result,e.target.error)},e.readAsDataURL(this)},$('[data-toggle="photo-upload-delete"]').on("click",function(e){e.preventDefault();var t=$(this).parent().attr("id"),a=$(this).parent(),n=$(this),i=$('input[data-show-element="#'+t+'"]'),o=$(i).attr("data-duplicate-name");$(a).find("img").attr("src",""),$(a).find(".file-name").html(""),$(a).parent().addClass("d-none"),$(i).val("").parents(".loaded-photo").removeClass("loaded-photo d-none").siblings(".order-2").not(".loaded-photo").addClass("d-none"),$('[name="'+o+'"]').val("");var s=!0;$(n).parents(".upl-docs-module__item-content").find('input[type="hidden"]').each(function(){if(""!=$(this).val())return s=!1}),setTimeout(function(){s&&$(n).parents(".upl-docs-module__item-content").find('[data-toggle="photo-upload-submit"]').addClass("disabled")},0)}),

/*$(".upl-docs-module__upload-file input").on("change",function(){var e=this.files[0],a=e.name,n=$(this).attr("data-show-element"),t=$(this),o=$(this).attr("data-duplicate-name");e.convertToBase64(function(e){$(this).parent().parent().addClass("d-none"),$(n).parent().removeClass("d-none"),$(n).find(".img-wrapper").find("img").attr("src",e),$(n).find(".file-name").html(a),$(t).parent().parent().addClass("loaded-photo").removeClass("d-none").nextAll(".d-none").eq(0).removeClass("d-none");$('[name="'+o+'"]').val(e.concat(":",a))}),$(this).parents(".upl-docs-module__item-content").find('[data-toggle="photo-upload-submit"]').removeClass("disabled")}),*/

$(".upl-docs-module__upload-file input").on('change', function () {
	var thisElem = $(this);
	var thisSelect = $(thisElem).parents('.mb-4').find("select");
	var selectedFile = this.files[0];
	var selectedFileName = selectedFile.name;
	var thisShowElem = $(this).attr('data-show-element');
	var thisDuplicateName = $(this).attr('data-duplicate-name');

	selectedFile.convertToBase64(function (base64) {
		$(this).parent().parent().addClass('d-none');
		$(thisShowElem).parent().removeClass('d-none');

		$(thisShowElem).find('.img-wrapper').find('img').attr('src', base64);
		var thisFileCaption = $(thisShowElem).find('.file-name');
		$(thisFileCaption).html($(thisSelect).val() || selectedFileName);
		$(thisFileCaption).attr("data-toggle", "tooltip");
		$(thisFileCaption).attr("data-placement", "left");
		$(thisFileCaption).attr("title", $(thisSelect).val() || selectedFileName);

		$(thisElem).parent().parent().addClass('loaded-photo').removeClass('d-none').nextAll('.d-none').eq(0).removeClass('d-none');

		var extentsion = selectedFileName.substring(selectedFileName.lastIndexOf('.'));
		var alpha = base64.concat(":", ($(thisSelect).val() || selectedFileName)+extentsion);
		$('[name="' + thisDuplicateName + '"]').val(alpha);
		$('[data-toggle="tooltip"]').tooltip();
	});

	$(this).parents('.upl-docs-module__item-content').find('[data-toggle="photo-upload-submit"]').removeClass('disabled');
});


$('[data-toggle="photo-upload-submit"]').on("click",function(e){e.preventDefault();var t=$(this).parents(".upl-docs-module__item");$(t).find(".invalid-feedback").remove(),$(t).find("input").valid()&&($(t).removeClass("active").addClass("completed").find(".collapse").collapse("toggle"),$(t).next().find(".upl-docs-module__item-toggle:not(.active)").trigger("click"))}),$(document).off("click change",'[data-toggle="reset"]').on("click change",'[data-toggle="reset"]',function(){var e=$(this).parent().find("input");$(e).val("").trigger("change")}),$(document).off("click",'[data-toggle="cart-slide-up"]').on("click",'[data-toggle="cart-slide-up"]',function(e){e.preventDefault(),$("#selectionees-produits-nos-solutions-modal").toggleClass("active"),$(this).toggleClass("active")});String.prototype.format=String.prototype.format=function(){for(var t=this,r=arguments.length;r--;)t=t.replace(new RegExp("\\{"+r+"\\}","gm"),arguments[r]);return t};function GetUrlParams(urlSearch,sVar){return unescape(urlSearch.replace(new RegExp("^(?:.*[&\\?]"+escape(sVar).replace(/[\.\+\*]/g,"\\$&")+"(?:\\=([^&]*))?)?.*$","i"),"$1"))}function filterValues(r,e){return r.filter(CreateFilterFn(e))}function CreateFilterFn(r){var e=r.toLowerCase();return function(r){return-1!=r[0].toLowerCase().indexOf(e)}}function toObject(r,e,t){var n=filterValues(r,e);return n.length>1?{[e]:getArrval(n)}:{[e]:t}}function getArrval(r){const n=r.values();var o=[];for(const r of n)o.push(r[1]);return Array.from(new Set(o))}function SerializeValuesToJSON(r){return Object.assign(...Array.from(r,([e,t])=>toObject(r,e,t)))}function SetJsonValForCheckBoxes(r,e){var a=document.querySelector(r),o=new FormData(a).entries(),n=SerializeValuesToJSON(Array.from(o));return n.hasOwnProperty(e)?Array.isArray(n[e])?n[e]:[n[e]]:null}
function getCetDefaultProperties(t,o){showLoading(),$.ajax({method:"GET",contentType:"application/json",data:{products:t},url:"/get-cet-readonly-properties",dataType:"html"}).done(function(t,e,n){200==n.status&&($(o).find("div.inner-content").empty(),$(o).find("div.inner-content").append(t),$(o).addClass("active"),hideLoading())}).fail(function(t){console.error(t)})}

function getProductPower(products, prospectId) {
	return $.ajax({
		method: "GET",
		contentType: "application/json",
		data: { products: products, prospectId: prospectId },
		url: "/get-product-power",
		dataType: "html"
	})
}


function getProductbyPowerType(t,e){return $.ajax({method:"GET",contentType:"application/json",data:{products:t,prospectId:e},url:"/get-product-by-power-type",dataType:"html"})}function getPackProductsbyids(t,o,e){showLoading(),$.ajax({method:"GET",contentType:"application/json",data:{products:t,packId:e},url:"/get-pack-products-by-ids",dataType:"html"}).done(function(t,e,n){200==n.status&&($(o).empty(),$(o).append(t),$(o).niceSelect("update"),$(o).next().removeClass("not-empty"),hideLoading())}).fail(function(t){console.error(t)})}function getComposantsByProduct(t){return showLoading(),$.ajax({method:"GET",contentType:"application/json",data:{products:t},url:"/get-composants-by-products",dataType:"json"})}function getProductProperties(t,o){return $.ajax({method:"GET",contentType:"application/json",data:{productId:t,dynamicpropertyidname:o},url:"/get-products-propertiesoption-as-json",dataType:"json"})}
function getProductsSubstitute(t, o, h) {
	return $.ajax({
		method: "GET",
		contentType: "application/json",
		data: {
			productId: t,
			producttypecode: o,
			tarifId: h
		},
		url: "/get-related-products-by-substitutedproductid",
		dataType: "json"
	})
}
function _InitValidators(){$(".form-validate").each(function(){$(this).validate({validateDelegate:function(){},onsubmit:!0,errorElement:"div",errorPlacement:function(e,t){switch(e.addClass("invalid-feedback"),t.prop("type")){case"select-one":e.appendTo(t.parent());break;case"checkbox":e.insertAfter(t.parent("label"));break;case"radio":t.parent().hasClass("button-control")?e.appendTo(t.parents(".row, .form-row")[0]):e.insertAfter(t.parent("label"));break;case"file":e.appendTo(t.parents(".form-row").parent());break;default:$(this).parents(".input-group")?e.insertAfter(t.parent()):e.insertAfter(t)}},highlight:function(e,t,a){$(e).addClass("is-invalid").parent().addClass("is-invalid")},unhighlight:function(e,t,a){$(e).removeClass("is-invalid").parent().removeClass("is-invalid")},focusInvalid:!1,invalidHandler:function(e,t){if(t.numberOfInvalids()){$(t.errorList).each(function(){$(this.element).parents(".collapse:not(.show)").length>0&&$(this.element).parents(".collapse").collapse("toggle").prev().addClass("active").parent().addClass("active")});var a=$(t.errorList[0].element);if("select-one"!==$(a).prop("type")&&"radio"!==$(a).prop("type")&&"checkbox"!==$(a).prop("type")||(a=$(a).parent()),$(a).parents(".modal").length>0){var n=$(this).parents(".modal"),i=$(n).scrollTop()+$(a).offset().top-120;$(n).animate({scrollTop:i},400)}else{i=$(a).offset().top-120;$("html, body").animate({scrollTop:i},400)}}},ignore:".tab-pane:hidden *, .body:not(.current) *, .control-mobile-hidden:hidden *, .control-only-mobile:hidden *, :disabled, .no-validate"}),setTimeout(function(){$(this).find(".num-input").each(function(){$(this).rules("add",{required:!0,number:!0})}),$(this).find('[type="email"]').each(function(){$(this).rules("add",{required:!0,email:!0})})},0)})}
function getProductPrice(t, o,h) {
	return $.ajax({
		method: "GET",
		contentType: "application/json",
		data: {
			productId: t,
			prospectId: o,
			tarifId: h
		},
		url: "/get-product-price",
		dataType: "json"
	})
}
function getCartProducts(t, a, o, c, h) {
	return showLoading(), $.ajax({
		method: "GET",
		contentType: "application/json",
		data: {
			products: t,
			packtext: a,
			prospectId: o,
			central_tva: c,
			tarifId: h
		},
		url: "/get-cart-product",
		dataType: "html"
	})
}

function getCodePromo(o){return showLoading(),$.ajax({method:"GET",contentType:"application/json",data:{code:o},url:"/get-code-promo",dataType:"json"})}function getIdProducts(e){let t=[];if(e.hasOwnProperty("chauffeEau")){let o=e.chauffeEau;t.push(o.capacity)}if(e.hasOwnProperty("centralPhotovoltaique")){let o=e.centralPhotovoltaique;if(t.push(o.id),o.hasOwnProperty("optimisationAutoconso")){let e=o.optimisationAutoconso;t.push(e)}if(o.hasOwnProperty("solutionStockage")){let e=o.solutionStockage;t.push(e)}}if(e.hasOwnProperty("pompeChaleurAirEau")){let o=e.pompeChaleurAirEau;t.push(o.puissance)}if(e.hasOwnProperty("BorneDeRecharge")){let o=e.BorneDeRecharge;t.push(o.puissance)}if(e.hasOwnProperty("relampingLED")){let o=e.relampingLED;t.push(o.produit)}if(e.hasOwnProperty("isolation")){let o=e.isolation;t.push(o.Gamme)}return t}
function UpdateLinks() {
	let prospectId = sessionStorage.getItem("prospectId");
	let quoteId = sessionStorage.getItem("quoteId");
	let linkParams = "#"
	if (prospectId != null) {
		linkParams = "?prospectId={0}".format(prospectId);
	}

	//first part of app
	UpdateLinksHelper("#coord-du-benef-link", "href", "/coordonnees-du-beneficiaire" + linkParams);
	UpdateLinksHelper("#etude-logt-link", "href", "/etude-logement" + linkParams);
	UpdateLinksHelper("#etude-potentiel-sol-link", "href", "/etude-potentiel-solaire" + linkParams);
	UpdateLinksHelper("#vos-conso-link", "href", "/vos-consommations" + linkParams);
	UpdateLinksHelper("#eligibilite-aide-link", "href", "/eligibilite-aux-aides" + linkParams);
	UpdateLinksHelper("#pack-config-link", "href", "/les-packs-configurables" + linkParams);

	

	//second part
	if (!!quoteId) {
		linkParams += "&quoteId={0}".format(quoteId);
		UpdateLinksHelper("#simulation-projet-link", "href", "/simulation-de-votre-projet" + linkParams);
	}
}

function UpdateLinksHelper(selector, attribute, value) {
	$(selector).attr(attribute, value);
}

UpdateLinks();

function OpenIncidentForm() {
	$('#incident_modal').modal('show');
	return false;
}

var incidentsLinks = 
`<div class="incident-container">
<ul>
	<li>
		<a class="header-menu__sign-out" href="#" onclick="OpenIncidentForm();">Ouvrir un incident/Suggérer une amélioration</a>
	</li>
	<li>
		<a href="/mes-incidents">Mes incidents</a>
	</li>
	<ul>
</div>
`

var demoLinks = 
`<div class="demo-container">
<ul>
	<li>
		<a class="header-menu__sign-out"  href="/coordonnees-du-beneficiaire?isdemo=true">Effectuer une démo</a>
	</li>
	<ul>
</div>
`

var demoBlock =`<div id="demo_mode" class="demo-block">
					<span>Vous êtes en mode démo, l'étude ne sera pas conservée</span>
				</div>`

$('.header-menu__nav').append(incidentsLinks);
$('.header-menu__nav').append(demoLinks);
$('body').append(demoBlock);

setTimeout(() => {
	if (sessionStorage.getItem("isdemo") == "true") {
		$("#demo_mode").fadeIn();
	}
}, 500);


$(document).on('change', '[name="incidentType"]', function (e) {
	var thisVal = $(this).val();

	if(thisVal == 629950003)
	{
		$('.bug-details').fadeOut();
		$('#description h6.title').text('Avantage pour vous');
	}
	else
	{
		$('.bug-details').fadeIn();
		$('#description h6.title').text('Notes / commentaires');
	}
})

$(document).on('submit', '#incident_form', function (e) {
	e.preventDefault();
	if ($(this).valid())
	{
		var incidentRequest = $(this).serializeToJSON({
			associativeArrays: false
		});
		let baseUrl = $("#incident_modal").data('api');
		let entityRequest = {
			entityCode: "contact",
			entityRefGuid: $('[name="incidentType"]').data("user")
		}
		incidentRequest.customerRef = entityRequest;

		console.log(incidentRequest);
		showLoading();
		$.ajax({
			method: "POST",
			contentType: "application/json",
			url: baseUrl+"/api/incident/CreateIncidentManual",
			data: JSON.stringify(incidentRequest),
			dataType: "text"
		}).done(function (data, textstatus, xhr) {
			if (xhr.status == 200) {
				hideLoading();
				$('#incident_modal').modal('hide');
				ClearFields();
			}
		}).fail(function (xhr) {
			var errorObj = JSON.parse(xhr.responseText);
			$("#error-modal .error-msg").html(errorObj.error);
			$("#error-modal").modal('show');
			console.error(xhr);
			hideLoading();
		});
	}
	return false;
})

function ClearFields() {
	$('[name="incidentTitle"]').val("");
	$('[name="bugDetails"]').val("");
	$('[name="exceptedResults"]').val("");
	$('[name="description"]').val("");
}